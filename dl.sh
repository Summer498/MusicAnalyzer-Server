#!/bin/bash -e
# mimicopy is derived from è€³ã‚³ãƒ” (Japanese word meaning sound transcription)
# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯ UTF-8
# dl.sh song_URL
pushd `dirname "$0"` > /dev/null

red=[31m
green=[32m
defcol=[39m

help(){
    awk 'NR > 3 {                          # ã‚·ãƒãƒ³ã¯å‡ºåŠ›ã—ãªã„
    if (/^#/) { sub("^# ?", ""); print } # /^#/ ã«ãƒžãƒƒãƒã—ãŸã‚‰ "^# ?" ã‚’å–ã‚Šé™¤ã„ã¦å‡ºåŠ›
    else { exit }                        # /^#/ ã«ãƒžãƒƒãƒã—ãªããªã£ãŸã‚‰çµ‚äº†
    }' $0 | column -t -s , # å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆè‡ªèº«ã‚’å¼•æ•°ã«å–ã‚‹
    exit 0;
}
processOptions(){
    tgt=$1
    shift
    opts=($@)
    flag=0
    for i in ${!opts[@]}
    do
        if [[ "$tgt" =~ ${opts[$i]} ]]; then  # NOTE: $tgt includes ${opts[$i]}
            eval ${command[$i]}
            flag=1
            break
        fi
    done
    if [[ $flag -eq 0 ]]; then  # invalid option
        echo "invalid option $tgt" >&2
    fi
}


song_URL="$1"
save_dir="videos"
yt-dlp -o "$save_dir/%(uploader)s/%(fulltitle)s.%(ext)s" -f "ba*" -S "+size" --merge-output-format webm --recode-video mp4 $song_URL
